Power_BC <- sum(TD_BC)/sum(epsilon)
E_BC <- c_0 * sum(FD_BC) + c_1 * sum(bl_II_BC)
c(FWER_Bon = FWER_Bon,
FDR_Bon = FDR_Bon,
Power_Bon = Power_Bon,
E_Bon = E_Bon,
FWER_BH = FWER_BH,
FDR_BH = FDR_BH,
Power_BH = Power_BH,
E_BH = E_BH,
FWER_BFDR = FWER_BFDR,
FDR_BFDR = FDR_BFDR,
Power_BFDR = Power_BFDR,
E_BFDR = E_BFDR,
FWER_BC = FWER_BC,
FDR_BC = FDR_BC,
Power_BC = Power_BC,
E_BC = E_BC)
})
apply(results, 1, mean)
})
})
})
})
View(results)
df_results <- do.call(rbind,
lapply(seq_along(n_list), function(i_n) {
lapply(seq_along(m_list), function(i_m) {
lapply(seq_along(eps_list), function(i_eps) {
lapply(seq_along(c(0.1, 0.1 * sqrt(200/m_list[i_m]))), function(i_alpha) {
res <- results[[i_n]][[i_m]][[i_eps]][[i_alpha]]
data.frame(
n     = n_list[i_n],
m     = m_list[i_m],
eps   = eps_list[i_eps],
alpha = c(0.1, 0.1 * sqrt(200/m_list[i_m]))[i_alpha],
t(res)
)
})
})
})
})
)
View(df_results)
for (i_n in seq_along(n_list)) {
for (i_m in seq_along(m_list)) {
alpha_list <- c(0.1, 0.1 * sqrt(200/m_list[i_m]))
for (i_eps in seq_along(eps_list)) {
for (i_alpha in seq_along(alpha_list)) {
res <- results[[i_n]][[i_m]][[i_eps]][[i_alpha]]
df_results <- rbind(
df_results,
data.frame(
n     = n_list[i_n],
m     = m_list[i_m],
eps   = eps_list[i_eps],
alpha = alpha_list[i_alpha],
t(res)
)
)
}
}
}
}
df_results <- do.call(rbind,
lapply(seq_along(n_list), function(i_n) {
lapply(seq_along(m_list), function(i_m) {
lapply(seq_along(eps_list), function(i_eps) {
lapply(seq_along(c(0.1, 0.1 * sqrt(200/m_list[i_m]))), function(i_alpha) {
res <- results[[i_n]][[i_m]][[i_eps]][[i_alpha]]
data.frame(
n     = n_list[i_n],
m     = m_list[i_m],
eps   = eps_list[i_eps],
alpha = c(0.1, 0.1 * sqrt(200/m_list[i_m]))[i_alpha],
t(res)
)
})
})
})
})
)
View(df_results)
df_results <- do.call(rbind,
lapply(seq_along(n_list), function(i_n) {
lapply(seq_along(m_list), function(i_m) {
lapply(seq_along(eps_list), function(i_eps) {
lapply(seq_along(c(0.1, 0.1 * sqrt(200/m_list[i_m]))), function(i_alpha) {
res <- results[[i_n]][[i_m]][[i_eps]][[i_alpha]]
data.frame(
n     = n_list[i_n],
m     = m_list[i_m],
eps   = eps_list[i_eps],
alpha = alpha_list[i_alpha],
as.list(res)
)
})
})
})
})
)
View(df_results)
str(results[[1]][[1]][[1]][[1]])
for (i_n in seq_along(results)) {
for (i_m in seq_along(results[[i_n]])) {
for (i_eps in seq_along(results[[i_n]][[i_m]])) {
for (i_alpha in seq_along(results[[i_n]][[i_m]][[i_eps]])) {
res <- results[[i_n]][[i_m]][[i_eps]][[i_alpha]]
df_results <- rbind(
df_results,
cbind(
n     = n_list[i_n],
m     = m_list[i_m],
eps   = eps_list[i_eps],
alpha = c(0.1, 0.1 * sqrt(200/m_list[i_m]))[i_alpha],
as.data.frame(t(res))
)
)
}
}
}
}
df_results <- data.frame()
for (i_n in seq_along(results)) {
for (i_m in seq_along(results[[i_n]])) {
for (i_eps in seq_along(results[[i_n]][[i_m]])) {
for (i_alpha in seq_along(results[[i_n]][[i_m]][[i_eps]])) {
res <- results[[i_n]][[i_m]][[i_eps]][[i_alpha]]
df_results <- rbind(
df_results,
cbind(
n     = n_list[i_n],
m     = m_list[i_m],
eps   = eps_list[i_eps],
alpha = c(0.1, 0.1 * sqrt(200/m_list[i_m]))[i_alpha],
as.data.frame(t(res))
)
)
}
}
}
}
View(df_results)
library(dplyr)
library(tidyr)
df_long <- df_results %>%
pivot_longer(
cols = -c(n, m, eps, alpha),
names_to = c("Metric", "Test"),
names_sep = "_",
values_to = "Value"
)
library(ggplot2)
plot_metric <- function(metric_name) {
ggplot(
df_long %>% filter(Metric == metric_name),
aes(
x = eps,
y = Value,
color = Test,
shape = factor(alpha),
group = interaction(Test, alpha)
)
) +
geom_line() +
geom_point(size = 2) +
facet_grid(m ~ n, labeller = label_both) +
labs(
x = expression(epsilon),
y = metric_name,
shape = expression(alpha),
color = "Test"
) +
theme_bw() +
theme(
strip.background = element_rect(fill = "grey90"),
legend.position = "right"
)
}
plot_metric("FWER")
plot_metric("FDR")
plot_metric("Power")
plot_metric("E")
results <- lapply(n_list, function(n) {
lapply(m_list, function(m) {
alpha_list <- c(0.1, 0.1 * sqrt(200/m))
lapply(eps_list, function(eps) {
lapply(alpha_list, function(alpha) {
results <- replicate(1000, {
epsilon <- rbinom(n, 1, eps)
X <- rgamma(n, m, 1/3) * (1 - epsilon) + rgamma(n, m, 1/5.5)*epsilon
p_vals <- 1 - pgamma(X, m, 1/3)
#Bonferroni
results_Bon <- p_vals < alpha/n
FD_Bon <- results_Bon & (1 - epsilon)
TD_Bon <- results_Bon & epsilon
bl_II_Bon <- (1 - results_Bon) & epsilon
FWER_Bon <- sum(FD_Bon) >= 1
FDR_Bon <- sum(FD_Bon)/max(sum(results_Bon), 1)
Power_Bon <- sum(TD_Bon)/sum(epsilon)
E_Bon <- c_0 * sum(FD_Bon) + c_1 * sum(bl_II_Bon)
#Benjamini-Hochberg
BH_threshold <- alpha * (1:n)/n
p_sorted <- sort(p_vals, decreasing = TRUE)
results_BH <- p_vals <= p_sorted[which.max(p_sorted <= BH_threshold)]
FD_BH <- results_BH & (1 - epsilon)
TD_BH <- results_BH & epsilon
bl_II_BH <- (1 - results_BH) & epsilon
FWER_BH <- sum(FD_BH) >= 1
FDR_BH <- sum(FD_BH)/max(sum(results_BH), 1)
Power_BH <- sum(TD_BH)/sum(epsilon)
E_BH <- c_0 * sum(FD_BH) + c_1 * sum(bl_II_BH)
#BFDR
BFDR <- function(x) {
F0 <- pgamma(x, m, 1/3)
F1 <- (1 - eps) * pgamma(x, m, 1/3) + eps * pgamma(x, m, 1/5.5)
return((1 - eps) * (1 - F0)/(1 - F1) - alpha)
}
if (m == 20) {g <- 150} else {g <- 500}
cBFDR <- uniroot(BFDR, interval = c(0.0001,g))$root
result_BFDR <- X >= cBFDR
FD_BFDR <- result_BFDR & (1 - epsilon)
TD_BFDR <- result_BFDR & epsilon
bl_II_BFDR <- (1 - result_BFDR) & epsilon
FWER_BFDR <- sum(FD_BFDR) >= 1
FDR_BFDR <- sum(FD_BFDR)/max(sum(result_BFDR), 1)
Power_BFDR <- sum(TD_BFDR)/sum(epsilon)
E_BFDR <- c_0*sum(FD_BFDR)+c_1*sum(bl_II_BFDR)
#Bayes_Class
thres_BC <- log((1 - eps)/eps * (5.5/3)^m)/(1/3 - 1/5.5)
result_BC <- X >= thres_BC
FD_BC <- result_BC & (1 - epsilon)
TD_BC <- result_BC & epsilon
bl_II_BC <- (1 - result_BC) & epsilon
FWER_BC <- sum(FD_BC) >= 1
FDR_BC <- sum(FD_BC)/max(sum(result_BC), 1)
Power_BC <- sum(TD_BC)/sum(epsilon)
E_BC <- c_0 * sum(FD_BC) + c_1 * sum(bl_II_BC)
c(FWER_Bon = FWER_Bon,
FDR_Bon = FDR_Bon,
Power_Bon = Power_Bon,
E_Bon = E_Bon,
FWER_BH = FWER_BH,
FDR_BH = FDR_BH,
Power_BH = Power_BH,
E_BH = E_BH,
FWER_BFDR = FWER_BFDR,
FDR_BFDR = FDR_BFDR,
Power_BFDR = Power_BFDR,
E_BFDR = E_BFDR,
FWER_BC = FWER_BC,
FDR_BC = FDR_BC,
Power_BC = Power_BC,
E_BC = E_BC)
})
apply(results, 1, mean)
})
})
})
})
df_results <- data.frame()
for (i_n in seq_along(results)) {
for (i_m in seq_along(results[[i_n]])) {
for (i_eps in seq_along(results[[i_n]][[i_m]])) {
for (i_alpha in seq_along(results[[i_n]][[i_m]][[i_eps]])) {
res <- results[[i_n]][[i_m]][[i_eps]][[i_alpha]]
df_results <- rbind(
df_results,
cbind(
n     = n_list[i_n],
m     = m_list[i_m],
eps   = eps_list[i_eps],
alpha = c(0.1, 0.1 * sqrt(200/m_list[i_m]))[i_alpha],
as.data.frame(t(res))
)
)
}
}
}
}
library(dplyr)
library(tidyr)
df_long <- df_results %>%
pivot_longer(
cols = -c(n, m, eps, alpha),
names_to = c("Metric", "Test"),
names_sep = "_",
values_to = "Value"
)
library(ggplot2)
plot_metric <- function(metric_name) {
ggplot(
df_long %>% filter(Metric == metric_name),
aes(
x = eps,
y = Value,
color = Test,
shape = factor(alpha),
group = interaction(Test, alpha)
)
) +
geom_line() +
geom_point(size = 2) +
facet_grid(m ~ n, labeller = label_both) +
labs(
x = expression(epsilon),
y = metric_name,
shape = expression(alpha),
color = "Test"
) +
theme_bw() +
theme(
strip.background = element_rect(fill = "grey90"),
legend.position = "right"
)
}
plot_metric("FWER")
plot_metric("FDR")
plot_metric("Power")
plot_metric("E")
results <- lapply(n_list, function(n) {
lapply(m_list, function(m) {
alpha_list <- c(0.1, 0.1 * sqrt(200/m))
lapply(eps_list, function(eps) {
lapply(alpha_list, function(alpha) {
results <- replicate(1000, {
epsilon <- rbinom(n, 1, eps)
X <- rgamma(n, m, 1/3) * (1 - epsilon) + rgamma(n, m, 1/5.5)*epsilon
p_vals <- 1 - pgamma(X, m, 1/3)
#Bonferroni
results_Bon <- p_vals < alpha/n
FD_Bon <- results_Bon & (1 - epsilon)
TD_Bon <- results_Bon & epsilon
bl_II_Bon <- (1 - results_Bon) & epsilon
FWER_Bon <- sum(FD_Bon) >= 1
FDR_Bon <- sum(FD_Bon)/max(sum(results_Bon), 1)
Power_Bon <- sum(TD_Bon)/sum(epsilon)
E_Bon <- c_0 * sum(FD_Bon) + c_1 * sum(bl_II_Bon)
#Benjamini-Hochberg
BH_threshold <- alpha * (n:1)/n
p_sorted <- sort(p_vals, decreasing = TRUE)
results_BH <- p_vals <= p_sorted[which.max(p_sorted <= BH_threshold)]
FD_BH <- results_BH & (1 - epsilon)
TD_BH <- results_BH & epsilon
bl_II_BH <- (1 - results_BH) & epsilon
FWER_BH <- sum(FD_BH) >= 1
FDR_BH <- sum(FD_BH)/max(sum(results_BH), 1)
Power_BH <- sum(TD_BH)/sum(epsilon)
E_BH <- c_0 * sum(FD_BH) + c_1 * sum(bl_II_BH)
#BFDR
BFDR <- function(x) {
F0 <- pgamma(x, m, 1/3)
F1 <- (1 - eps) * pgamma(x, m, 1/3) + eps * pgamma(x, m, 1/5.5)
return((1 - eps) * (1 - F0)/(1 - F1) - alpha)
}
if (m == 20) {g <- 150} else {g <- 500}
cBFDR <- uniroot(BFDR, interval = c(0.0001,g))$root
result_BFDR <- X >= cBFDR
FD_BFDR <- result_BFDR & (1 - epsilon)
TD_BFDR <- result_BFDR & epsilon
bl_II_BFDR <- (1 - result_BFDR) & epsilon
FWER_BFDR <- sum(FD_BFDR) >= 1
FDR_BFDR <- sum(FD_BFDR)/max(sum(result_BFDR), 1)
Power_BFDR <- sum(TD_BFDR)/sum(epsilon)
E_BFDR <- c_0*sum(FD_BFDR)+c_1*sum(bl_II_BFDR)
#Bayes_Class
thres_BC <- log((1 - eps)/eps * (5.5/3)^m)/(1/3 - 1/5.5)
result_BC <- X >= thres_BC
FD_BC <- result_BC & (1 - epsilon)
TD_BC <- result_BC & epsilon
bl_II_BC <- (1 - result_BC) & epsilon
FWER_BC <- sum(FD_BC) >= 1
FDR_BC <- sum(FD_BC)/max(sum(result_BC), 1)
Power_BC <- sum(TD_BC)/sum(epsilon)
E_BC <- c_0 * sum(FD_BC) + c_1 * sum(bl_II_BC)
c(FWER_Bon = FWER_Bon,
FDR_Bon = FDR_Bon,
Power_Bon = Power_Bon,
E_Bon = E_Bon,
FWER_BH = FWER_BH,
FDR_BH = FDR_BH,
Power_BH = Power_BH,
E_BH = E_BH,
FWER_BFDR = FWER_BFDR,
FDR_BFDR = FDR_BFDR,
Power_BFDR = Power_BFDR,
E_BFDR = E_BFDR,
FWER_BC = FWER_BC,
FDR_BC = FDR_BC,
Power_BC = Power_BC,
E_BC = E_BC)
})
apply(results, 1, mean)
})
})
})
})
df_results <- data.frame()
for (i_n in seq_along(results)) {
for (i_m in seq_along(results[[i_n]])) {
for (i_eps in seq_along(results[[i_n]][[i_m]])) {
for (i_alpha in seq_along(results[[i_n]][[i_m]][[i_eps]])) {
res <- results[[i_n]][[i_m]][[i_eps]][[i_alpha]]
df_results <- rbind(
df_results,
cbind(
n     = n_list[i_n],
m     = m_list[i_m],
eps   = eps_list[i_eps],
alpha = c(0.1, 0.1 * sqrt(200/m_list[i_m]))[i_alpha],
as.data.frame(t(res))
)
)
}
}
}
}
library(dplyr)
library(tidyr)
df_long <- df_results %>%
pivot_longer(
cols = -c(n, m, eps, alpha),
names_to = c("Metric", "Test"),
names_sep = "_",
values_to = "Value"
)
library(ggplot2)
plot_metric <- function(metric_name) {
ggplot(
df_long %>% filter(Metric == metric_name),
aes(
x = eps,
y = Value,
color = Test,
shape = factor(alpha),
group = interaction(Test, alpha)
)
) +
geom_line() +
geom_point(size = 2) +
facet_grid(m ~ n, labeller = label_both) +
labs(
x = expression(epsilon),
y = metric_name,
shape = expression(alpha),
color = "Test"
) +
theme_bw() +
theme(
strip.background = element_rect(fill = "grey90"),
legend.position = "right"
)
}
plot_metric("FWER")
plot_metric("FDR")
plot_metric("Power")
plot_metric("E")
setwd("C:\\Users\\ameli\\Desktop\\Studia Programowanie\\projektmodelowanie\\data")
setwd("C:\\Users\\ameli\\Desktop\\Studia Programowanie\\projektmodelowanie\\data")
dane_fizyczne <- data.frame <- {
alpha <- 19.0
p <- 101325.0
r <- 287.05
c <- 1005
P <- 915
lambda_air <- 0.0262
lambda_brick <- 0.8
lambda_glass <- 1.05
}
dane_fizyczne <- data.frame(
alpha <- 19.0,
p <- 101325.0,
r <- 287.05,
c <- 1005,
P <- 915,
lambda_air <- 0.0262,
lambda_brick <- 0.8,
lambda_glass <- 1.05,
)
dane_fizyczne <- data.frame(
alpha = 19.0,
p = 101325.0,
r = 287.05,
c = 1005,
P = 915,
lambda_air = 0.0262,
lambda_brick = 0.8,
lambda_glass = 1.05,
)
dane_fizyczne <- data.frame(
alpha = 19.0,
p = 101325.0,
r = 287.05,
c = 1005,
P = 915,
lambda_air = 0.0262,
lambda_brick = 0.8,
lambda_glass = 1.05
)
write.csv(dane_fizyczne, "dane_fizyczne.csv", row.names = FALSE)
setwd("C:\\Users\\ameli\\Desktop\\Studia Programowanie\\projektmodelowanie\\data")
dane_fizyczne <- data.frame(
alpha = 19.0,
p = 101325.0,
r = 8.31446261815324,
c = 1005,
P = 915,
lambda_air = 0.0262,
lambda_brick = 0.8,
lambda_glass = 1.05
)
write.csv(dane_fizyczne, "dane_fizyczne.csv", row.names = FALSE)
