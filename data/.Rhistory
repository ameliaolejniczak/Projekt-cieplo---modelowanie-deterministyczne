mu1_pl_in <-mu1_k[mu1_k > 0][length(mu1_k[mu1_k > 0])]
mu0_pl_in <- mu0_k[mu0_k > 0][length(mu0_k[mu0_k > 0])]
#BH
progBH <- a * (n:1)/((1 - eps_pl_in) * n)
psort <- sort(p_w, decreasing = TRUE)
prog_BH <- psort[which.max(psort <= progBH)]
result_BH <- (p_w <= prog_BH)
FD_BH <- result_BH & (1 - eps)
TD_BH <- result_BH & eps
bl_II_BH <- (1 - result_BH) & eps
m_BH[i, 1] <- sum(FD_BH)/max(sum(result_BH), 1)
m_BH[i, 2]  <- sum(TD_BH)/sum(eps)
m_BH[i, 3] <- c_0 * sum(FD_BH) + c_1 * sum(bl_II_BH)
# BFDR
BFDR <- function(x) {
#F0 <- pgamma(x, m, 1/mu0_pl_in)
F0 <- pgamma(x, m, 1/3)
#F1 <- (1 - eps_pl_in) * pgamma(x, m, 1/mu0_pl_in) + eps_pl_in * pgamma(x, m, 1/mu1_pl_in)
F1 <- (1 - eps_pl_in) * pgamma(x, m, 1/3) + eps_pl_in * pgamma(x, m, 1/mu1_pl_in)
return((1 - eps_pl_in) * (1 - F0)/(1 - F1) - a)
}
if(m == 20){g <- 200} else {g <- 500}
low <- BFDR(0.0001)
high <- BFDR(g)
if (is.nan(low) || is.nan(high) || low * high > 0) {
cBFDR <- Inf
} else {
cBFDR <- uniroot(BFDR, interval = c(0.0001, g))$root
}
result_BFDR <- X >= cBFDR
FD_BFDR <- result_BFDR & (1 - eps)
TD_BFDR <- result_BFDR & eps
bl_II_BFDR <- (1 - result_BFDR) & eps
m_BFDR[i, 1] <- sum(FD_BFDR)/max(sum(result_BFDR), 1)
m_BFDR[i, 2] <- sum(TD_BFDR)/sum(eps)
m_BFDR[i, 3] <- c_0 * sum(FD_BFDR) + c_1 * sum(bl_II_BFDR)
#Bayes_Class
#thres_BC <- log((1 - eps_pl_in)/eps_pl_in * (mu1_pl_in/mu0_pl_in)^m)/(1/mu0_pl_in-1/mu1_pl_in)
thres_BC <- log((1 - eps_pl_in)/eps_pl_in * (mu1_pl_in/3)^m)/(1/3-1/mu1_pl_in)
result_BC <- X >= thres_BC
FD_BC <- result_BC & (1 - eps)
TD_BC <- result_BC & eps
bl_II_BC <- (1 - result_BC) & eps
m_BC[i, 1] <- sum(FD_BC)/max(sum(result_BC), 1)
m_BC[i, 2] <- sum(TD_BC)/sum(eps)
m_BC[i, 3] <- c_0 * sum(FD_BC) + c_1 * sum(bl_II_BC)
}
bh <- apply(m_BH, 2, mean)
bfdr <- apply(m_BFDR, 2, mean)
bc <- apply(m_BC, 2, mean)
return(list(Bh = bh, Bfdr = bfdr, Bc = bc))
}
param_m_20_pl_in <- expand.grid(a = c(0.1, 0.1 * sqrt(10)), n = c(200, 1000), e = c(0.05, 0.1, 0.2))
wyniki_m_20_pl_in <- vector("list", 12)
for(i in seq_len(12)) {
wyniki_m_20_pl_in[[i]] <- zad_4(m = 20, n = param_m_20_pl_in$n[i], e = param_m_20_pl_in$e[i], a = param_m_20_pl_in$a[i], sim = 1000)
}
names(wyniki_m_20_pl_in) <- apply(param_m_20_pl_in, 1, function(x) paste0("a=", x["a"], "_n=", x["n"], "_e=", x["e"]))
names(wyniki_m_20_pl_in) <- apply(param_m_20_pl_in, 1, function(x) paste0("a=", x["a"], "_n=", x["n"], "_e=", x["e"]))
param_m_100_pl_in <- expand.grid(a = c(0.1, 0.1 * sqrt(2)), n = c(200, 1000), e = c(0.05, 0.1, 0.2))
wyniki_m_100_pl_in <- vector("list", 12)
for(i in seq_len(12)) {
wyniki_m_100_pl_in[[i]] <- zad_4(m = 100, n = param_m_100_pl_in$n[i], e = param_m_100_pl_in$e[i], a = param_m_100_pl_in$a[i], sim = 1000)
}
names(wyniki_m_100_pl_in) <- apply(param_m_100_pl_in, 1, function(x) paste0("a=", x["a"], "_n=", x["n"], "_e=", x["e"]))
zrob_df_z_4 <- function(wynik) {
df <- rbind(BH = wynik$Bh, BFDR = wynik$Bfdr, BC = wynik$Bc)
colnames(df) <- c("FDR", "moc", "koszt")
as.data.frame(df)
}
tabele_m_20_pl_in <- lapply(wyniki_m_20_pl_in, zrob_df_z_4)
tabele_m_100_pl_in <- lapply(wyniki_m_100_pl_in, zrob_df_z_4)
library(dplyr)
library(tidyr)
library(purrr)
df_all_zad4 <- imap_dfr(tabele_m_20_pl_in, function(x, name) {
# wyciągamy parametry z nazwy
params <- strsplit(name, "_")[[1]]
a <- as.numeric(sub("a=", "", params[1]))
n <- as.numeric(sub("n=", "", params[2]))
e <- as.numeric(sub("e=", "", params[3]))
# zamiana data.frame 3x3 na tidy format
as.data.frame(x) %>%
mutate(metryka = rownames(x)) %>%
pivot_longer(
cols = -metryka,
names_to = "wariant",
values_to = "wartosc"
) %>%
mutate(a = a, n = n, e = e)
})
library(dplyr)
library(dplyr)
library(ggplot2)
df_all_zad4 <- df_all_zad4 %>%
mutate(
a = factor(a),
n = factor(n),
procedura = factor(metryka, levels = c("BH", "BFDR", "BC")),
wariant = factor(wariant, levels = c("FDR", "moc", "koszt"))
)
library(ggplot2)
ggplot(
df_all_zad4 %>% filter(wariant == "FDR"),
aes(x = e, y = wartosc, color = n, group = n)
) +
geom_line() +
geom_point(size = 3) +
facet_grid(
procedura ~ a,
scales = "free_y"
) +
labs(
x = expression(epsilon),
y = "FDR",
title = "False Discovery Rate (plug-in procedures)",
color = "n"
) +
theme_bw()
ggplot(
df_all_zad4 %>% filter(wariant == "moc"),
aes(x = e, y = wartosc, color = n, group = n)
) +
geom_line() +
geom_point(size = 3) +
facet_grid(
procedura ~ a,
scales = "free_y"
) +
labs(
x = expression(epsilon),
y = "FDR",
title = "False Discovery Rate (plug-in procedures)",
color = "n"
) +
theme_bw()
ggplot(
df_all_zad4 %>% filter(wariant == "koszt"),
aes(x = e, y = wartosc, color = n, group = n)
) +
geom_line() +
geom_point(size = 3) +
facet_grid(
procedura ~ a,
scales = "free_y"
) +
labs(
x = expression(epsilon),
y = "FDR",
title = "False Discovery Rate (plug-in procedures)",
color = "n"
) +
theme_bw()
zrob_df_all <- function(tabele, m_val){
imap_dfr(tabele, function(x, name) {
params <- strsplit(name, "_")[[1]]
a <- as.numeric(sub("a=", "", params[1]))
n <- as.numeric(sub("n=", "", params[2]))
e <- as.numeric(sub("e=", "", params[3]))
as.data.frame(x) %>%
mutate(metoda = rownames(x)) %>%
pivot_longer(
cols = -metoda,
names_to = "miara",
values_to = "wartosc"
) %>%
mutate(
a = a,
n = n,
e = e,
m = m_val
)
})
}
df_plug_in <- bind_rows(
zrob_df_all(tabele_m_20_pl_in, 20),
zrob_df_all(tabele_m_100_pl_in, 100)
) %>% mutate(typ = "plug-in")
df_direct <- df_long %>%
filter(
Metric %in% c("FDR", "Power", "E"),
Test %in% c("BH", "BFDR", "BC")
) %>%
mutate(
miara = recode(
Metric,
"Power" = "moc",
"E"     = "koszt"
),
metoda = Test,
typ = "direct",
wartosc = Value,
e = eps,
a = alpha
) %>%
select(
metoda, miara, wartosc,
a, n, e, m, typ
)
df_zad4_all <- bind_rows(df_direct, df_plug_in)
plot_zad4_facet <- function(df, miara_nazwa, tytul) {
ggplot(
df %>% filter(miara == miara_nazwa),
aes(
x = e,
y = wartosc,
color = typ,
shape = factor(a),
group = interaction(typ, a)
)
) +
geom_line(linewidth = 0.7) +
geom_point(size = 2.5) +
facet_grid(
n + m ~ metoda,
labeller = labeller(
n = function(x) paste0("n: ", x),
m = function(x) paste0("m: ", x)
)
) +
labs(
title = tytul,
x = expression(epsilon),
y = miara_nazwa,
color = "Estimation method",
shape = expression(alpha)
) +
theme_bw() +
theme(
legend.position = "bottom",
strip.background = element_rect(fill = "grey90"),
strip.text = element_text(face = "bold"),
plot.title = element_text(hjust = 0.5)
)
}
plot_zad4_facet(df_zad4_all, "FDR", "Comparison of FDR: direct vs plug-in")
plot_zad4_facet(df_zad4_all, "moc", "Comparison of power: direct vs plug-in")
plot_zad4_facet(df_zad4_all, "koszt", "Comparison of cost: direct vs plug-in")
zad_4 <- function(m, n, e, a, sim){
m_BH <- matrix(0, nrow = sim, ncol=3)
m_BFDR <- matrix(0, nrow = sim, ncol=3)
m_BC <- matrix(0, nrow = sim, ncol=3)
for (i in 1:sim){
eps <- rbinom(n, 1, e)
X <- rgamma(n, m, 1/3) * (1 - eps) + rgamma(n, m, 1/5.5) * eps
p_w <- 1 - pgamma(X, m, 1/3)
c_0 <- 1
c_1 <- 1
eps_k <- rep(0, 500)
mu1_k <- rep(0, 500)
mu0_k <- rep(0, 500)
eps_k[1] <- 0.5
mu0_k[1] <- mean(X[X <= median(X)])
mu1_k[1] <- mean(X[X >= median(X)])
D <- 1
k <- 1
while (D > 10^(-5) & k < 500){
pi <- dgamma(X, m, 1/mu1_k[k]) * eps_k[k]/(dgamma(X, m, 1/mu1_k[k]) * eps_k[k] + dgamma(X, m, 1/mu0_k[k]) * (1 - eps_k[k]))
eps_k[k + 1] <- sum(pi)/n
mu1_k[k + 1] <- sum(pi * X)/sum(pi * m)
mu0_k[k + 1] <- sum(X * (1 - pi))/sum(m * (1 - pi))
D <- (mu1_k[k + 1] - mu1_k[k])^2 + (eps_k[k + 1] - eps_k[k])^2 + (mu0_k[k + 1] - mu0_k[k])^2
k <- k + 1
}
eps_pl_in <- eps_k[eps_k > 0][length(eps_k[eps_k > 0])]
mu1_pl_in <-mu1_k[mu1_k > 0][length(mu1_k[mu1_k > 0])]
mu0_pl_in <- mu0_k[mu0_k > 0][length(mu0_k[mu0_k > 0])]
#BH
progBH <- a * (n:1)/((1 - eps_pl_in) * n)
psort <- sort(p_w, decreasing = TRUE)
prog_BH <- psort[which.max(psort <= progBH)]
result_BH <- (p_w <= prog_BH)
FD_BH <- result_BH & (1 - eps)
TD_BH <- result_BH & eps
bl_II_BH <- (1 - result_BH) & eps
m_BH[i, 1] <- sum(FD_BH)/max(sum(result_BH), 1)
m_BH[i, 2]  <- sum(TD_BH)/sum(eps)
m_BH[i, 3] <- c_0 * sum(FD_BH) + c_1 * sum(bl_II_BH)
# BFDR
BFDR <- function(x) {
F0 <- pgamma(x, m, 1/mu0_pl_in)
F1 <- (1 - eps_pl_in) * pgamma(x, m, 1/mu0_pl_in) + eps_pl_in * pgamma(x, m, 1/mu1_pl_in)
return((1 - eps_pl_in) * (1 - F0)/(1 - F1) - a)
}
if(m == 20){g <- 200} else {g <- 500}
low <- BFDR(0.0001)
high <- BFDR(g)
if (is.nan(low) || is.nan(high) || low * high > 0) {
cBFDR <- Inf
} else {
cBFDR <- uniroot(BFDR, interval = c(0.0001, g))$root
}
result_BFDR <- X >= cBFDR
FD_BFDR <- result_BFDR & (1 - eps)
TD_BFDR <- result_BFDR & eps
bl_II_BFDR <- (1 - result_BFDR) & eps
m_BFDR[i, 1] <- sum(FD_BFDR)/max(sum(result_BFDR), 1)
m_BFDR[i, 2] <- sum(TD_BFDR)/sum(eps)
m_BFDR[i, 3] <- c_0 * sum(FD_BFDR) + c_1 * sum(bl_II_BFDR)
#Bayes_Class
thres_BC <- log((1 - eps_pl_in)/eps_pl_in * (mu1_pl_in/mu0_pl_in)^m)/(1/mu0_pl_in-1/mu1_pl_in)
result_BC <- X >= thres_BC
FD_BC <- result_BC & (1 - eps)
TD_BC <- result_BC & eps
bl_II_BC <- (1 - result_BC) & eps
m_BC[i, 1] <- sum(FD_BC)/max(sum(result_BC), 1)
m_BC[i, 2] <- sum(TD_BC)/sum(eps)
m_BC[i, 3] <- c_0 * sum(FD_BC) + c_1 * sum(bl_II_BC)
}
bh <- apply(m_BH, 2, mean)
bfdr <- apply(m_BFDR, 2, mean)
bc <- apply(m_BC, 2, mean)
return(list(Bh = bh, Bfdr = bfdr, Bc = bc))
}
param_m_20_pl_in <- expand.grid(a = c(0.1, 0.1 * sqrt(10)), n = c(200, 1000), e = c(0.05, 0.1, 0.2))
wyniki_m_20_pl_in <- vector("list", 12)
for(i in seq_len(12)) {
wyniki_m_20_pl_in[[i]] <- zad_4(m = 20, n = param_m_20_pl_in$n[i], e = param_m_20_pl_in$e[i], a = param_m_20_pl_in$a[i], sim = 1000)
}
names(wyniki_m_20_pl_in) <- apply(param_m_20_pl_in, 1, function(x) paste0("a=", x["a"], "_n=", x["n"], "_e=", x["e"]))
param_m_100_pl_in <- expand.grid(a = c(0.1, 0.1 * sqrt(2)), n = c(200, 1000), e = c(0.05, 0.1, 0.2))
wyniki_m_100_pl_in <- vector("list", 12)
for(i in seq_len(12)) {
wyniki_m_100_pl_in[[i]] <- zad_4(m = 100, n = param_m_100_pl_in$n[i], e = param_m_100_pl_in$e[i], a = param_m_100_pl_in$a[i], sim = 1000)
}
names(wyniki_m_100_pl_in) <- apply(param_m_100_pl_in, 1, function(x) paste0("a=", x["a"], "_n=", x["n"], "_e=", x["e"]))
zrob_df_z_4 <- function(wynik) {
df <- rbind(BH = wynik$Bh, BFDR = wynik$Bfdr, BC = wynik$Bc)
colnames(df) <- c("FDR", "moc", "koszt")
as.data.frame(df)
}
tabele_m_20_pl_in <- lapply(wyniki_m_20_pl_in, zrob_df_z_4)
tabele_m_100_pl_in <- lapply(wyniki_m_100_pl_in, zrob_df_z_4)
library(dplyr)
library(tidyr)
library(purrr)
df_all_zad4 <- imap_dfr(tabele_m_20_pl_in, function(x, name) {
# wyciągamy parametry z nazwy
params <- strsplit(name, "_")[[1]]
a <- as.numeric(sub("a=", "", params[1]))
n <- as.numeric(sub("n=", "", params[2]))
e <- as.numeric(sub("e=", "", params[3]))
# zamiana data.frame 3x3 na tidy format
as.data.frame(x) %>%
mutate(metryka = rownames(x)) %>%
pivot_longer(
cols = -metryka,
names_to = "wariant",
values_to = "wartosc"
) %>%
mutate(a = a, n = n, e = e)
})
library(dplyr)
library(dplyr)
library(ggplot2)
df_all_zad4 <- df_all_zad4 %>%
mutate(
a = factor(a),
n = factor(n),
procedura = factor(metryka, levels = c("BH", "BFDR", "BC")),
wariant = factor(wariant, levels = c("FDR", "moc", "koszt"))
)
library(ggplot2)
ggplot(
df_all_zad4 %>% filter(wariant == "FDR"),
aes(x = e, y = wartosc, color = n, group = n)
) +
geom_line() +
geom_point(size = 3) +
facet_grid(
procedura ~ a,
scales = "free_y"
) +
labs(
x = expression(epsilon),
y = "FDR",
title = "False Discovery Rate (plug-in procedures)",
color = "n"
) +
theme_bw()
ggplot(
df_all_zad4 %>% filter(wariant == "moc"),
aes(x = e, y = wartosc, color = n, group = n)
) +
geom_line() +
geom_point(size = 3) +
facet_grid(
procedura ~ a,
scales = "free_y"
) +
labs(
x = expression(epsilon),
y = "FDR",
title = "False Discovery Rate (plug-in procedures)",
color = "n"
) +
theme_bw()
ggplot(
df_all_zad4 %>% filter(wariant == "koszt"),
aes(x = e, y = wartosc, color = n, group = n)
) +
geom_line() +
geom_point(size = 3) +
facet_grid(
procedura ~ a,
scales = "free_y"
) +
labs(
x = expression(epsilon),
y = "FDR",
title = "False Discovery Rate (plug-in procedures)",
color = "n"
) +
theme_bw()
zrob_df_all <- function(tabele, m_val){
imap_dfr(tabele, function(x, name) {
params <- strsplit(name, "_")[[1]]
a <- as.numeric(sub("a=", "", params[1]))
n <- as.numeric(sub("n=", "", params[2]))
e <- as.numeric(sub("e=", "", params[3]))
as.data.frame(x) %>%
mutate(metoda = rownames(x)) %>%
pivot_longer(
cols = -metoda,
names_to = "miara",
values_to = "wartosc"
) %>%
mutate(
a = a,
n = n,
e = e,
m = m_val
)
})
}
df_plug_in <- bind_rows(
zrob_df_all(tabele_m_20_pl_in, 20),
zrob_df_all(tabele_m_100_pl_in, 100)
) %>% mutate(typ = "plug-in")
df_direct <- df_long %>%
filter(
Metric %in% c("FDR", "Power", "E"),
Test %in% c("BH", "BFDR", "BC")
) %>%
mutate(
miara = recode(
Metric,
"Power" = "moc",
"E"     = "koszt"
),
metoda = Test,
typ = "direct",
wartosc = Value,
e = eps,
a = alpha
) %>%
select(
metoda, miara, wartosc,
a, n, e, m, typ
)
df_zad4_all <- bind_rows(df_direct, df_plug_in)
plot_zad4_facet <- function(df, miara_nazwa, tytul) {
ggplot(
df %>% filter(miara == miara_nazwa),
aes(
x = e,
y = wartosc,
color = typ,
shape = factor(a),
group = interaction(typ, a)
)
) +
geom_line(linewidth = 0.7) +
geom_point(size = 2.5) +
facet_grid(
n + m ~ metoda,
labeller = labeller(
n = function(x) paste0("n: ", x),
m = function(x) paste0("m: ", x)
)
) +
labs(
title = tytul,
x = expression(epsilon),
y = miara_nazwa,
color = "Estimation method",
shape = expression(alpha)
) +
theme_bw() +
theme(
legend.position = "bottom",
strip.background = element_rect(fill = "grey90"),
strip.text = element_text(face = "bold"),
plot.title = element_text(hjust = 0.5)
)
}
plot_zad4_facet(df_zad4_all, "FDR", "Comparison of FDR: direct vs plug-in")
plot_zad4_facet(df_zad4_all, "moc", "Comparison of power: direct vs plug-in")
plot_zad4_facet(df_zad4_all, "koszt", "Comparison of cost: direct vs plug-in")
setwd("C:\\Users\\ameli\\Desktop\\Studia Programowanie\\Ciepło modelowanie\\data")
dane_fizyczne <- data.frame(
alpha = 2.239 * 10 **(-5),
p = 101325.0,
r = 287.05,
c = 1005,
P = 915,
lambda_air = 0.0262,
U_wall_inside = 1.0,
U_wall = 0.2,
lambda_glass = 0.9
)
write.csv(dane_fizyczne, "dane_fizyczne.csv", row.names = FALSE)
